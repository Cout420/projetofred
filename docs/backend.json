{
  "entities": {
    "Testimonial": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Testimonial",
      "type": "object",
      "description": "Represents a testimonial from a client.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the testimonial."
        },
        "authorName": {
          "type": "string",
          "description": "Name of the testimonial author (dog owner)."
        },
        "testimonialText": {
          "type": "string",
          "description": "The content of the testimonial."
        },
        "dogName": {
          "type": "string",
          "description": "Name of the dog mentioned in the testimonial."
        },
        "imageURL": {
          "type": "string",
          "description": "URL of an image to display with the testimonial.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "authorName",
        "testimonialText"
      ]
    },
    "ContactFormSubmission": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ContactFormSubmission",
      "type": "object",
      "description": "Represents a submission from the contact form.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the contact form submission."
        },
        "name": {
          "type": "string",
          "description": "Name of the person submitting the form."
        },
        "email": {
          "type": "string",
          "description": "Email address of the person submitting the form.",
          "format": "email"
        },
        "phoneNumber": {
          "type": "string",
          "description": "Phone number of the person submitting the form."
        },
        "message": {
          "type": "string",
          "description": "The message or project request from the person submitting the form."
        },
        "submissionDate": {
          "type": "string",
          "description": "Date and time the form was submitted.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "message",
        "submissionDate"
      ]
    },
    "Service": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Service",
      "type": "object",
      "description": "Represents a dog training service offered.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the service."
        },
        "title": {
          "type": "string",
          "description": "Title of the service."
        },
        "description": {
          "type": "string",
          "description": "Description of the service."
        },
        "imageURL": {
          "type": "string",
          "description": "URL of an image representing the service.",
          "format": "uri"
        },
        "price": {
          "type": "number",
          "description": "Price of the service."
        }
      },
      "required": [
        "id",
        "title",
        "description"
      ]
    },
    "ImageGalleryItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ImageGalleryItem",
      "type": "object",
      "description": "Represents an image in the image gallery.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the image gallery item."
        },
        "imageURL": {
          "type": "string",
          "description": "URL of the image.",
          "format": "uri"
        },
        "description": {
          "type": "string",
          "description": "Optional description of the image."
        }
      },
      "required": [
        "id",
        "imageURL"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/testimonials/{testimonialId}",
        "definition": {
          "entityName": "Testimonial",
          "schema": {
            "$ref": "#/backend/entities/Testimonial"
          },
          "description": "Stores client testimonials.  Admin access managed via /roles_admin/{uid}.",
          "params": [
            {
              "name": "testimonialId",
              "description": "Unique identifier for the testimonial."
            }
          ]
        }
      },
      {
        "path": "/contact_form_submissions/{submissionId}",
        "definition": {
          "entityName": "ContactFormSubmission",
          "schema": {
            "$ref": "#/backend/entities/ContactFormSubmission"
          },
          "description": "Stores contact form submissions. Write access is public, read access is restricted to admins, verified by the /roles_admin/{uid} collection.",
          "params": [
            {
              "name": "submissionId",
              "description": "Unique identifier for the contact form submission."
            }
          ]
        }
      },
      {
        "path": "/services/{serviceId}",
        "definition": {
          "entityName": "Service",
          "schema": {
            "$ref": "#/backend/entities/Service"
          },
          "description": "Stores dog training services. Admin access managed via /roles_admin/{uid}.",
          "params": [
            {
              "name": "serviceId",
              "description": "Unique identifier for the service."
            }
          ]
        }
      },
      {
        "path": "/image_gallery/{imageId}",
        "definition": {
          "entityName": "ImageGalleryItem",
          "schema": {
            "$ref": "#/backend/entities/ImageGalleryItem"
          },
          "description": "Stores images for the gallery. Admin access managed via /roles_admin/{uid}.",
          "params": [
            {
              "name": "imageId",
              "description": "Unique identifier for the image gallery item."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{uid}",
        "definition": {
          "entityName": "user",
          "schema": {
            "$ref": "#/backend/entities/user"
          },
          "description": "Database-Based Access Control: Existence of a document with the user's `uid` in this collection grants admin privileges.",
          "params": [
            {
              "name": "uid",
              "description": "The Firebase User ID of the administrator."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to accommodate the data entities defined for the Projeto Frederico Landing app, focusing on testimonials, contact form submissions, services, and image gallery items. The structure emphasizes clarity, security, and scalability.\n\n*   `/testimonials`: Stores client testimonials. This collection is globally readable to display social proof on the landing page. Access to create, update, and delete testimonials is restricted to admins. To achieve authorization independence, no denormalization is needed, as the access control is based on admin roles, verified by the `roles_admin` collection.\n*   `/contact_form_submissions`: Stores contact form submissions. Write access is public, allowing anyone to submit the form. Read access is restricted to admins to protect user data. Authorization independence is achieved as no data from other collections is needed to validate access to this collection.\n*   `/services`: Stores dog training services. This collection is globally readable to display service information on the landing page. Write access (create, update, delete) is restricted to admins, verified by the `roles_admin` collection.  Authorization independence is achieved as no data from other collections is needed to validate access to this collection.\n*   `/image_gallery`: Stores images for the gallery. Similar to testimonials and services, this collection is publicly readable, with write access restricted to admins.  Authorization independence is achieved as no data from other collections is needed to validate access to this collection.\n*   `/roles_admin/{uid}`: This collection implements DBAC (Database-Based Access Control). The existence of a document with the user's `uid` in this collection grants admin privileges. This approach is favored over custom claims for its simplicity and ease of management. Rules check for document existence to grant admin access.\n\n**Authorization Independence:**\nAuthorization independence is achieved by avoiding `get()` calls in security rules. Admin access is determined by the existence of a document in the `/roles_admin/{uid}` collection, eliminating the need to fetch user roles from other parts of the database. This simplifies the rules and ensures atomic operations.\n\n**QAPs (Rules are not Filters):**\nThe structure supports secure list operations by:\n\n*   Segregation: Data with different access requirements (e.g., public testimonials vs. private contact form submissions) are stored in separate collections. This allows for simple rules that grant read access to entire collections or restrict access based on admin roles.\n*   DBAC: Admin status is verified by checking for the existence of a document in the `/roles_admin/{uid}` collection, ensuring list operations are secure and efficient."
  }
}